#!/usr/bin/env bash
set -euo pipefail
SCRIPT_DIR="$(cd -- "$(dirname -- "$0")" && pwd -P)"
# 1) Repo root via git; fallback relative to versioned hooks dir
REPO_ROOT="$(git -C "$SCRIPT_DIR" rev-parse --show-toplevel 2>/dev/null || true)"
if [ -z "${REPO_ROOT:-}" ]; then
  REPO_ROOT="$(cd "$SCRIPT_DIR/../.." && pwd -P)"
fi
if [ ! -d "$REPO_ROOT" ]; then
  echo "[protected-paths] unable to determine repo root" >&2
  exit 1
fi
# 2) Prefer tools under repo root; fallback for .git/hooks runtime
if [ -d "$REPO_ROOT/tools" ]; then
  GUARD_DIR="$REPO_ROOT/tools"
elif [ -d "$SCRIPT_DIR/../../tools" ]; then
  GUARD_DIR="$(cd "$SCRIPT_DIR/../../tools" && pwd -P)"
else
  echo "[protected-paths] guard directory not found" >&2
  exit 1
fi
GUARD="$GUARD_DIR/protected_paths_guard.py"
if [ ! -f "$GUARD" ]; then
  echo "[protected-paths] guard script not found at $GUARD" >&2
  exit 1
fi
exec python3 "$GUARD"
